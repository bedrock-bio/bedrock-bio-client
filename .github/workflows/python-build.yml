name: python-build

on:
  pull_request:
    branches: ["main"]

jobs:
  build:
    name: python-build
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: python
    steps:
      - name: check-out-repository
        uses: actions/checkout@v5
      - name: install-uv
        uses: astral-sh/setup-uv@v7
        with:
          working-directory: python
          enable-cache: true
      - name: build-package
        run: uv build
      - name: smoke-test-wheel
        run: uv run --isolated --no-project --with dist/*.whl tests/smoke_test.py
      - name: smoke-test-sdist
        run: uv run --isolated --no-project --with dist/*.tar.gz tests/smoke_test.py